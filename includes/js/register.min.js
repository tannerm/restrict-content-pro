function rcp_validate_form(a){rcp_validate_subscription_level(),a&&rcp_validate_gateways(),rcp_validate_discount()}function rcp_validate_subscription_level(){if(!rcp_validating_level){var a=jQuery,b=!1,d=a("#rcp_subscription_levels input:checked"),e=a(".rcp_gateway_fields").hasClass("rcp_discounted_100"),f="forever"==d.data("duration"),g=rcp_script_options.trial_levels.indexOf(d.val())!==-1;rcp_validating_level=!0,0==d.attr("rel")&&(b=!0),b?(a(".rcp_gateway_fields,#rcp_auto_renew_wrap,#rcp_discount_code_wrap").hide(),a(".rcp_gateway_fields").removeClass("rcp_discounted_100"),a("#rcp_discount_code_wrap input").val(""),a(".rcp_discount_amount,#rcp_gateway_extra_fields").remove(),a(".rcp_discount_valid, .rcp_discount_invalid").hide(),a("#rcp_auto_renew_wrap input").prop("checked",!1)):(e?a("#rcp_gateway_extra_fields").remove():f?(a("#rcp_auto_renew_wrap input").prop("checked",!1),a("#rcp_auto_renew_wrap").hide()):a(".rcp_gateway_fields,#rcp_auto_renew_wrap").show(),g&&(a("#rcp_auto_renew_wrap input").prop("checked",!0),a("#rcp_auto_renew_wrap").hide()),a("#rcp_discount_code_wrap").show()),rcp_validating_level=!1}}function rcp_get_gateway(){var a,b=jQuery;return b("#rcp_payment_gateways").length>0?(a=b("#rcp_payment_gateways select option:selected"),a.length<1&&(a=b('input[name="rcp_gateway"]:checked'))):a=b('input[name="rcp_gateway"]'),a}function rcp_validate_gateways(){if(!rcp_validating_gateway){var a=jQuery,b=a("#rcp_registration_form"),c=!1,e=a("#rcp_subscription_levels input:checked");if(!e.val())var e=a('#rcp_submit_wrap input[name="rcp_level"]');var f=a(".rcp_gateway_fields").hasClass("rcp_discounted_100"),g="forever"==e.data("duration"),h=rcp_script_options.trial_levels.indexOf(e.val())!==-1,i=rcp_get_gateway();if(rcp_validating_gateway=!0,0==e.attr("rel")&&(c=!0),a(".rcp_message.error",b).remove(),c)a(".rcp_gateway_fields").hide(),a("#rcp_gateway_extra_fields").remove();else{if(f)a("#rcp_gateway_extra_fields").remove();else{b.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),a(".rcp_gateway_fields").show();var j={action:"rcp_load_gateway_fields",rcp_gateway:i.val()};a.post(rcp_script_options.ajaxurl,j,function(c){a("#rcp_gateway_extra_fields").remove(),c.success&&c.data.fields&&(a(".rcp_gateway_fields").length?a('<div class="rcp_gateway_'+i.val()+'_fields" id="rcp_gateway_extra_fields">'+c.data.fields+"</div>").insertAfter(".rcp_gateway_fields"):a('<div class="rcp_gateway_'+i.val()+'_fields" id="rcp_gateway_extra_fields">'+c.data.fields+"</div>").insertAfter(".rcp_gateways_fieldset")),b.unblock()})}"yes"==i.data("supports-recurring")?(a("#rcp_auto_renew_wrap input").prop("checked",rcp_script_options.auto_renew_default),a("#rcp_auto_renew_wrap").show(),(f||g||c)&&(a("#rcp_auto_renew_wrap input").prop("checked",!1),a("#rcp_auto_renew_wrap").hide()),h&&"yes"==i.data("supports-trial")&&!rcp_script_options.user_has_trialed&&(a("#rcp_auto_renew_wrap input").prop("checked",!0),a("#rcp_auto_renew_wrap").hide())):(a("#rcp_auto_renew_wrap input").prop("checked",!1),a("#rcp_auto_renew_wrap").hide()),a("#rcp_discount_code_wrap").show()}rcp_validating_gateway=!1}}function rcp_validate_discount(){if(!rcp_validating_discount){var a=jQuery,b=a(".rcp_gateway_fields"),c=a("#rcp_discount_code").val(),d=!1,e=a("#rcp_subscription_levels input:checked");if(0==e.attr("rel")&&(d=!0),a("#rcp_subscription_levels input:checked").length)var f=a("#rcp_subscription_levels input:checked").val();else var f=a('input[name="rcp_level"]').val();if(!c)return a(".rcp_discount_valid, .rcp_discount_invalid").hide(),d?a("#rcp_auto_renew_wrap").hide():a("#rcp_auto_renew_wrap").show(),b.show().removeClass("rcp_discounted_100"),void rcp_validate_gateways();var g={action:"validate_discount",code:c,subscription_id:f};rcp_validating_discount=!0,a.post(rcp_script_options.ajaxurl,g,function(c){a(".rcp_discount_amount").remove(),a(".rcp_discount_valid, .rcp_discount_invalid").hide(),c.valid?c.valid&&(a(".rcp_discount_valid").show(),a("#rcp_discount_code_wrap label").append('<span class="rcp_discount_amount"> - '+c.amount+"</span>"),c.full?(a("#rcp_auto_renew_wrap").hide(),b.hide().addClass("rcp_discounted_100"),a("#rcp_gateway_extra_fields").remove()):(a("#rcp_auto_renew_wrap").show(),b.show().removeClass("rcp_discounted_100"),rcp_validate_gateways())):(a(".rcp_discount_invalid").show(),b.removeClass("rcp_discounted_100"),a(".rcp_gateway_fields,#rcp_auto_renew_wrap").show(),rcp_validate_gateways()),rcp_validating_discount=!1,a("body").trigger("rcp_discount_applied",[c])})}}function rcp_calc_total(){var a=jQuery,b=a(".rcp_registration_total"),c=a("#rcp_discount_code").val(),d=a("#rcp_subscription_levels input:checked").length?a("#rcp_subscription_levels input:checked").val():a('input[name="rcp_level"]').val(),e=rcp_get_gateway();if(b.length){rcp_calculating_total=!0;var f={action:"rcp_calc_discount",rcp_level:d,rcp_discount:c,rcp_gateway:e.val()};a("#rcp_auto_renew").is(":checked")&&(f.rcp_auto_renew=!0),a.post(rcp_script_options.ajaxurl,f,function(a){rcp_calculating_total=!1,void 0!==a.total&&b.html(a.total)})}}function rcp_validate_recaptcha(a){jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!1)}var rcp_validating_discount=!1,rcp_validating_gateway=!1,rcp_validating_level=!1,rcp_processing=!1,rcp_calculating_total=!1,gateway_submits_form=!1;jQuery(document).ready(function(a){rcp_validate_form(!0),rcp_calc_total(),a("#rcp_payment_gateways select, #rcp_payment_gateways input").change(function(){a("body").trigger("rcp_gateway_change")}),a(".rcp_level").change(function(){a("body").trigger("rcp_level_change")}),a("body").on("rcp_gateway_change",function(){rcp_validate_form(!0)}).on("rcp_level_change",function(){rcp_validate_form(!0)}),a("#rcp_apply_discount").on("click",function(b){b.preventDefault(),a("body").trigger("rcp_discount_change"),rcp_validate_discount()}),a(document.getElementById("rcp_auto_renew")).on("change",rcp_calc_total),a("body").on("rcp_discount_change rcp_level_change rcp_gateway_change",rcp_calc_total),"1"===rcp_script_options.recaptcha_enabled&&jQuery("#rcp_registration_form #rcp_submit").prop("disabled",!0),a(document).on("click","#rcp_registration_form #rcp_submit",function(b){b.preventDefault();var c=document.getElementById("rcp_registration_form"),d=a("#rcp_registration_form");d.attr("id");if("function"!=typeof c.checkValidity||!1!==c.checkValidity()){a(this).val();d.block({message:rcp_script_options.pleasewait,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff"}}),a("#rcp_submit",d).val(rcp_script_options.pleasewait),rcp_processing||(rcp_processing=!0,a.post(rcp_script_options.ajaxurl,d.serialize()+"&action=rcp_process_register_form&rcp_ajax=true",function(b){a(".rcp-submit-ajax",d).remove(),a(".rcp_message.error",d).remove()}).success(function(a){}).done(function(a){}).fail(function(a){console.log(a)}).always(function(a){}))}}),a(document).ajaxComplete(function(b,c,d){if(d.hasOwnProperty("data")&&d.data.indexOf("rcp_process_register_form")!==-1&&c.hasOwnProperty("responseJSON")&&c.responseJSON.hasOwnProperty("data")){if(c.responseJSON.data.success!==!0)return a("#rcp_registration_form #rcp_submit").val(rcp_script_options.register),a("#rcp_registration_form #rcp_submit").before(c.responseJSON.data.errors),a("#rcp_registration_form #rcp_register_nonce").val(c.responseJSON.data.nonce),a("#rcp_registration_form").unblock(),void(rcp_processing=!1);gateway_submits_form=!(!c.responseJSON.data.gateway.supports||c.responseJSON.data.gateway.supports.indexOf("gateway-submits-form")===-1),a("body").trigger("rcp_register_form_submission",[c.responseJSON.data,b.target.forms.rcp_registration_form.id]),0!=c.responseJSON.data.total&&gateway_submits_form||document.getElementById("rcp_registration_form").submit()}})});